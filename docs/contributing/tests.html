
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Testing JupyterHub and linting code &#8212; JupyterHub 3.1.0.dev documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contributing/tests';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The JupyterHub roadmap" href="roadmap.html" />
    <link rel="prev" title="Contributing Documentation" href="docs.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class=" navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../installation-guide.html">
                        Installation
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../getting-started/index.html">
                        Get Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../reference/index.html">
                        Technical Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../index-admin.html">
                        Administratorâ€™s Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api/index.html">
                        JupyterHub API
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../rbac/index.html">
                        JupyterHub RBAC
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Contributing
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../index-about.html">
                        About
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/jupyterhub/jupyterhub" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://discourse.jupyter.org/c/jupyterhub/10" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../installation-guide.html">
                        Installation
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../getting-started/index.html">
                        Get Started
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../reference/index.html">
                        Technical Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../index-admin.html">
                        Administratorâ€™s Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api/index.html">
                        JupyterHub API
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../rbac/index.html">
                        JupyterHub RBAC
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Contributing
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../index-about.html">
                        About
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/jupyterhub/jupyterhub" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://discourse.jupyter.org/c/jupyterhub/10" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="community.html">Community communication channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setting up a development install</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Contributing Documentation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Testing JupyterHub and linting code</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">The JupyterHub roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Reporting security issues in Jupyter or JupyterHub</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="testing-jupyterhub-and-linting-code">
<span id="contributing-tests"></span><h1>Testing JupyterHub and linting code<a class="headerlink" href="#testing-jupyterhub-and-linting-code" title="Permalink to this heading">#</a></h1>
<p>Unit test help validate that JupyterHub works the way we think it does,
and continues to do so when changes occur. They also help communicate
precisely what we expect our code to do.</p>
<p>JupyterHub uses <a class="reference external" href="https://pytest.org">pytest</a> for all our tests. You
can find them under <code class="docutils literal notranslate"><span class="pre">jupyterhub/tests</span></code> directory in the git repository.</p>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this heading">#</a></h2>
<ol class="arabic">
<li><p>Make sure you have completed <a class="reference internal" href="setup.html#contributing-setup"><span class="std std-ref">Setting up a development install</span></a>. You should be able
to start <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> from the commandline &amp; access it from your
web browser. This ensures that the dev environment is properly set
up for tests to run.</p></li>
<li><p>You can run all tests in JupyterHub</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest -v jupyterhub/tests
</pre></div>
</div>
<p>This should display progress as it runs all the tests, printing
information about any test failures as they occur.</p>
<p>If you wish to confirm test coverage the run tests with the <code class="docutils literal notranslate"><span class="pre">--cov</span></code> flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest -v --cov<span class="o">=</span>jupyterhub jupyterhub/tests
</pre></div>
</div>
</li>
<li><p>You can also run tests in just a specific file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest -v jupyterhub/tests/&lt;test-file-name&gt;
</pre></div>
</div>
</li>
<li><p>To run a specific test only, you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest -v jupyterhub/tests/&lt;test-file-name&gt;::&lt;test-name&gt;
</pre></div>
</div>
<p>This runs the test with function name <code class="docutils literal notranslate"><span class="pre">&lt;test-name&gt;</span></code> defined in
<code class="docutils literal notranslate"><span class="pre">&lt;test-file-name&gt;</span></code>. This is very useful when you are iteratively
developing a single test.</p>
<p>For example, to run the test <code class="docutils literal notranslate"><span class="pre">test_shutdown</span></code> in the file <code class="docutils literal notranslate"><span class="pre">test_api.py</span></code>,
you would run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest -v jupyterhub/tests/test_api.py::test_shutdown
</pre></div>
</div>
<p>See the <a class="reference external" href="https://pytest.readthedocs.io/en/latest/usage.html">pytest usage documentation</a> for more details.</p>
</li>
</ol>
</section>
<section id="test-organisation">
<h2>Test organisation<a class="headerlink" href="#test-organisation" title="Permalink to this heading">#</a></h2>
<p>The tests live in <code class="docutils literal notranslate"><span class="pre">jupyterhub/tests</span></code> and are organized roughly into:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">test_api.py</span></code> tests the REST API</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_pages.py</span></code> tests loading the HTML pages</p></li>
</ol>
<p>and other collections of tests for different components.
When writing a new test, there should usually be a test of
similar functionality already written and related tests should
be added nearby.</p>
<p>The fixtures live in <code class="docutils literal notranslate"><span class="pre">jupyterhub/tests/conftest.py</span></code>. There are
fixtures that can be used for JupyterHub components, such as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">app</span></code>: an instance of JupyterHub with mocked parts</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auth_state_enabled</span></code>: enables persisting auth_state (like authentication tokens)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">db</span></code>: a sqlite in-memory DB session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">io_loop`</span></code>: a Tornado event loop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_loop</span></code>: a new asyncio event loop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: creates a new temporary user</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">admin_user</span></code>: creates a new temporary admin user</p></li>
<li><p>single user servers
- <code class="docutils literal notranslate"><span class="pre">cleanup_after</span></code>: allows cleanup of single user servers between tests</p></li>
<li><p>mocked service
- <code class="docutils literal notranslate"><span class="pre">MockServiceSpawner</span></code>: a spawner that mocks services for testing with a short poll interval
- <code class="docutils literal notranslate"><span class="pre">mockservice`</span></code>: mocked service with no external service url
- <code class="docutils literal notranslate"><span class="pre">mockservice_url</span></code>: mocked service with a url to test external services</p></li>
</ul>
<p>And fixtures to add functionality or spawning behavior:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">admin_access</span></code>: grants admin access</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no_patience`</span></code>: sets slow-spawning timeouts to zero</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slow_spawn</span></code>: enables the SlowSpawner (a spawner that takes a few seconds to start)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">never_spawn</span></code>: enables the NeverSpawner (a spawner that will never start)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bad_spawn</span></code>: enables the BadSpawner (a spawner that fails immediately)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slow_bad_spawn</span></code>: enables the SlowBadSpawner (a spawner that fails after a short delay)</p></li>
</ul>
<p>See the <a class="reference external" href="https://pytest.readthedocs.io/en/latest/fixture.html">pytest fixtures documentation</a>
for how to use the existing fixtures, and how to create new ones.</p>
</section>
<section id="troubleshooting-test-failures">
<h2>Troubleshooting Test Failures<a class="headerlink" href="#troubleshooting-test-failures" title="Permalink to this heading">#</a></h2>
<section id="all-the-tests-are-failing">
<h3>All the tests are failing<a class="headerlink" href="#all-the-tests-are-failing" title="Permalink to this heading">#</a></h3>
<p>Make sure you have completed all the steps in <a class="reference internal" href="setup.html#contributing-setup"><span class="std std-ref">Setting up a development install</span></a> successfully, and
can launch <code class="docutils literal notranslate"><span class="pre">jupyterhub</span></code> from the terminal.</p>
</section>
</section>
<section id="code-formatting-and-linting">
<h2>Code formatting and linting<a class="headerlink" href="#code-formatting-and-linting" title="Permalink to this heading">#</a></h2>
<p>JupyterHub has adopted automatic code formatting and linting.
As long as your code is valid, the pre-commit hook should take care of how it should look.
You can invoke the pre-commit hook by hand at any time with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pre-commit run
</pre></div>
</div>
<p>which should run any autoformatting on your code and tell you about any errors it couldnâ€™t fix automatically.
You may also install <a class="reference external" href="https://github.com/psf/black#editor-integration">black integration</a>
into your text editor to format code automatically.</p>
<p>If you have already committed files before running pre-commit you can fix everything using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pre-commit run --all-files
</pre></div>
</div>
<p>And committing the changes.</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="docs.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Contributing Documentation</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="roadmap.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">The JupyterHub roadmap</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-the-tests">
   Running the tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-organisation">
   Test organisation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#troubleshooting-test-failures">
   Troubleshooting Test Failures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#all-the-tests-are-failing">
     All the tests are failing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-formatting-and-linting">
   Code formatting and linting
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://github.com/jupyterhub/jupyterhub/edit/main/docs/contributing/tests.rst">
        <i class="fa-solid fa-pencil"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/contributing/tests.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2016, Project Jupyter team.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>